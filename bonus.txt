Added multithreading as specified in HW doc